var beijingUrl="//www.beijing.gov.cn";var yonghuUrl=beijingUrl+"/hudong/yonghu";function ajax(options){options=options||{};options.type=(options.type||"GET").toUpperCase();options.dataType=options.dataType||"json";options.async=options.async||true;var arr=[];for(var name in options.data){arr.push(encodeURIComponent(name)+"="+encodeURIComponent(options.data[name]))}arr.push(("v="+Math.random()).replace(".",""));var params=arr.join("&");if(window.XMLHttpRequest){var xhr=new XMLHttpRequest()}else{var xhr=new ActiveXObject('Microsoft.XMLHTTP')}if(options.xhrFields.withCredentials){xhr.withCredentials=true}if(options.type=="GET"){xhr.open("GET",options.url+"?"+params,options.async);xhr.send(null)}else if(options.type=="POST"){xhr.open("POST",options.url,options.async);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.send(params)}xhr.onreadystatechange=function(){if(xhr.readyState==4){var status=xhr.status;if(status>=200&&status<300){options.success&&options.success(xhr.responseText)}else{options.fail&&options.fail(status)}}}}function IEVersion(){var userAgent=navigator.userAgent;var isIE=userAgent.indexOf("compatible")>-1&&userAgent.indexOf("MSIE")>-1;var isEdge=userAgent.indexOf("Edge")>-1&&!isIE;var isIE11=userAgent.indexOf('Trident')>-1&&userAgent.indexOf("rv:11.0")>-1;if(isIE){var reIE=new RegExp("MSIE (\\d+\\.\\d+);");reIE.test(userAgent);var fIEVersion=parseFloat(RegExp["$1"]);if(fIEVersion==7){return 7}else if(fIEVersion==8){return 8}else if(fIEVersion==9){return 9}else if(fIEVersion==10){return 10}else{return 6}}else if(isEdge){return'edge'}else if(isIE11){return 11}else{return-1}}(function(){try{if(location.search.indexOf('?pc')!==0&&/Android|Windows Phone|iPhone|iPod/i.test(navigator.userAgent)){var mLoginBox=document.getElementsByClassName("m-login-box")[0];mLoginBox.style.display=""}initLogin();var ma=document.createElement('script');ma.type='text/javascript';ma.async=true;ma.src='//www.beijing.gov.cn/hudong/yonghu/js/front/hdSynSingle.min.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ma,s)}catch(e){}})();var _yfx_trackdata = _yfx_trackdata || [];function initLogin(){var mLoginBoxArr=document.getElementsByClassName("m-login-box");var unn="";var ud="";var mLoginBox=mLoginBoxArr[mLoginBoxArr.length-1];if(typeof mLoginBox!="undefined"){var btnLogin=mLoginBox.getElementsByClassName("btn-login")[0];var btnUsername=mLoginBox.getElementsByClassName("btn-username")[0];var btnUserBox=mLoginBox.getElementsByClassName("btn-user-box")[0];var userNameUrl="/uSpace/myUserName";ajax({url:yonghuUrl+userNameUrl,type:"GET",xhrFields:{withCredentials:true},success:function(response){var res;try{res=JSON.parse(response)}catch(e){res={}}var unn=res["unn"];var eiqeId=res["eiqeId"];var user_json = { 'userid':eiqeId};_yfx_trackdata.push(["userset", user_json]);if(typeof res.code!="undefined"&&res.code==0&&typeof unn!="undefined"&&unn!=""){initCollectedArticle();btnLogin.classList.add("z-none");btnUsername.classList.remove("z-none");if(typeof btnUserBox != "undefined"){console.log(btnUserBox);btnUserBox.classList.remove("z-none");}btnUsername.setAttribute('title',unn);btnUsername.innerHTML=res["unn"]}},fail:function(e){var scButton=document.getElementsByClassName("grzx_btn_sc")[0];if(typeof scButton!="undefined"){scButton.style.display="";scButton.addEventListener("click",function(e){window.location.href="/hudong/yonghu"},false)}}})}setInterval(function(){synjj()},5000)}function collectedArticle(){var scButton=document.getElementsByClassName("grzx_btn_sc")[0];var qxscButton=document.getElementsByClassName("grzx_btn_qxsc")[0];var metas=document.getElementsByTagName("meta");var articleTitle="";var columnName="";var description="";var articleUrl=window.location.pathname;var keywords="";var pubDate="";for(var i=0;i<metas.length;i++){if(metas[i].getAttribute("name")=="ArticleTitle"){articleTitle=metas[i].getAttribute("content")}if(metas[i].getAttribute("name")=="ColumnName"){columnName=metas[i].getAttribute("content")}if(metas[i].getAttribute("name")=="PubDate"){pubDate=metas[i].getAttribute("content")}if(metas[i].getAttribute("name")=="Keywords"){keywords=metas[i].getAttribute("content")}if(metas[i].getAttribute("name")=="description"){description=metas[i].getAttribute("content")}}var articleId=articleUrl.substring(articleUrl.lastIndexOf("/")+2,articleUrl.lastIndexOf("."));if(articleId.indexOf("_")>-1){articleId=articleId.substring(articleId.lastIndexOf("_")+1)}var collectedUrl=yonghuUrl+"/uSpace/collectedArticle";var param={};param["type"]="update";param["articleId"]=articleId;param["title"]=articleTitle;param["columnName"]=columnName;param["description"]=description;param["url"]=articleUrl;param["keywords"]=keywords;param["pubDate"]=pubDate;ajax({url:collectedUrl,type:"GET",xhrFields:{withCredentials:true},data:param,dataType:"json",success:function(data){data=JSON.parse(data);if(data.code=="0"){if(scButton.style.display==""){qxscButton.style.display="";scButton.style.display="none";qxscButton.addEventListener("click",collectedArticle);scButton.removeEventListener("click",collectedArticle)}else{scButton.style.display="";qxscButton.style.display="none";scButton.addEventListener("click",collectedArticle);qxscButton.removeEventListener("click",collectedArticle)}}else if(data.code=="2"){scButton.style.display="";qxscButton.style.display="none";scButton.addEventListener("click",collectedArticle);qxscButton.removeEventListener("click",collectedArticle)}}})}function initCollectedArticle(){var articleUrl=window.location.pathname;var articleId=articleUrl.substring(articleUrl.lastIndexOf("/")+2,articleUrl.lastIndexOf("."));if(articleId.indexOf("_")>-1){articleId=articleId.substring(articleId.lastIndexOf("_")+1)}var scButton=document.getElementsByClassName("grzx_btn_sc")[0];var qxscButton=document.getElementsByClassName("grzx_btn_qxsc")[0];if(typeof scButton!="undefined"&&typeof qxscButton!="undefined"){var param={};param["type"]="get";param["articleId"]=articleId;ajax({url:yonghuUrl+"/uSpace/collectedArticle",type:"GET",xhrFields:{withCredentials:true},dataType:"json",data:param,success:function(data){data=JSON.parse(data);if(data.code=="0"){if(data.collected=="0"){scButton.style.display="";qxscButton.style.display="none";scButton.addEventListener("click",collectedArticle);qxscButton.removeEventListener("click",collectedArticle)}else{qxscButton.style.display="";scButton.style.display="none";qxscButton.addEventListener("click",collectedArticle);scButton.removeEventListener("click",collectedArticle)}}}})}}function synjj(){var u=window.location.href;if(u.indexOf("www.beijing.gov.cn/jj/?test=1")>-1){ajax({url:yonghuUrl+"/front/knlist",type:"post",dataType:"json",xhrFields:{withCredentials:false},data:{},success:function(datas){if(datas.length>0){var results=new Array();for(var i=0;i<datas.length;i++){var data=datas[i];var val=$('.czkj-textarea').val(data.name);$('.czkj-enter-btn').click();ajax({url:"/jj/dknowchat/dknowchat/ctrl/webSubscriber/chat",type:"post",xhrFields:{withCredentials:false},contentType:'application/json',dataType:"json",data:JSON.stringify({"text":data.name}),beforeSend:function(request){request.setRequestHeader("Token",window.robotToken)},success:function(res){if(typeof res==='string'&&JSON.parse(res).ret==401){data.answer=JSON.parse(res).content;results.push(data)}}})}ajax({url:yonghuUrl+"/front/addkn",type:"post",xhrFields:{withCredentials:false},contentType:'application/json',dataType:"json",data:results,success:function(r){console.log(r)}})}}})}}function speak(){if('speechSynthesis'in window){var synthesis=window.speechSynthesis;var content=document.getElementById('soundText').textContent;var utterance=new SpeechSynthesisUtterance(content);synthesis.speak(utterance)}else{console.log('Web Speech API不受支持')}}function shutup(){if('speechSynthesis'in window){var synthesis=window.speechSynthesis;synthesis.cancel()}}function logoutBak(){$.ajax({url : "//www.beijing.gov.cn/hudong/yonghu/login/uGjLogout",data : {},type : "GET",beforeSend : function() {},success : function(data) {if(data==""){window.location.href="//www.beijing.gov.cn/";}else{if(typeof data=="string"){window.location.href=data;}else{window.location.href="//www.beijing.gov.cn/";}}}});}function logSdzcOut(){$.ajax({url : "//www.beijing.gov.cn/hudong/yonghu/login/uSdzcLogout",data : {},xhrFields: {withCredentials: true},crossDomain: true,type : "GET",beforeSend : function() {},success : function(data) {if(data==""){}else{if(typeof data=="string"){}else{}}}});}function logout(){$.ajax({url : "//www.beijing.gov.cn/hudong/yonghu/login/uSdzcLogout",data : {},xhrFields: {withCredentials: true},crossDomain: true,type : "GET",beforeSend : function() {},success : function(data) {if(data==""){window.location.href="//www.beijing.gov.cn/";}else{if(typeof data=="string"){window.location.href="//www.beijing.gov.cn/";}else{window.location.href="//www.beijing.gov.cn/";}}}});}